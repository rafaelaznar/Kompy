<!DOCTYPE html>
<html lang="es">
<head><meta charset="UTF-8"><title>Demo</title></head>
<body>
  <h1>Componente externo</h1>
  <my-card>
    <span slot="title">Tarjeta</span>
    <span slot="desc">Descripción breve</span>
    <p>Contenido principal de la tarjeta.</p>
  </my-card>
  <my-button></my-button>


  <script type="module">
    // Carga un componente HTML externo y lo inyecta en la página
    async function importComponent(url) {
      const res = await fetch(url);
      const html = await res.text();
      const tpl = document.createElement('template');
      tpl.innerHTML = html;
      // append the internal <template> so it can be referenced by id
      const inner = tpl.content.querySelector('template');
      if (inner) document.body.appendChild(inner);

      // execute module script inside the component (if any)
      const script = tpl.content.querySelector('script[type="module"]');
      if (script) {
        const code = script.textContent;
        const blob = new Blob([code], { type: 'text/javascript' });
        const moduleUrl = URL.createObjectURL(blob);
        await import(moduleUrl);
      }
    }

    // implementa una function para cargar todos los componentes de /components
    async function loadAllComponents() {
      const components = [
        './components/my-button.html',
        './components/my-card.html',
      ];
      for (const component of components) {
        await importComponent(component);
      }
    }
    await loadAllComponents();

    // Delegated listener for my-button events: attach at document level
    document.addEventListener('my-button-click', (e) => {
      const h1 = document.querySelector('h1');
      if (h1) {
        const { timestamp, value } = e.detail || {};
        h1.textContent = `Has pulsado el my-button! ${value ? `(value=${value}) ` : ''}${timestamp ? new Date(timestamp).toLocaleTimeString() : ''}`;
        // cambia la descripcion del my-card slot="desc" para que agregue la hora del click
        const myCard = document.querySelector('my-card');
        if (myCard) {
          // find the light-DOM node that was assigned to slot="desc"
          const slotDesc = myCard.querySelector('[slot="desc"]');
          if (slotDesc) {
            slotDesc.textContent = `Descripción actualizada: ${value ? `(value=${value}) ` : ''}${timestamp ? new Date(timestamp).toLocaleTimeString() : ''}`;
          }
        }
      }
    });
  </script>
</body>
</html>
